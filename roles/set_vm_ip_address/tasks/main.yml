---
- name: Set VM IP Address
  vmware_guest:
    hostname: "{{ vcenter_server }}" # From workflow survey
    sername: "{{ vcenter_username }}" # From workflow survey
    password: "{{ vcenter_password }}" # From workflow survey
    cluster: "{{ vcenter_cluster }}" # From workflow survey
    datacenter: "{{ vcenter_datacenter }}" # From workflow survey
    datastore: "{{ vm_datastore }}" # From workflow survey
    folder: "/{{ vcenter_datacenter }}/vm" # From workflow survey
    validate_certs: "{{ vmware_validate_certs }}" # From role defaults
    name: "{{ server_hostname | upper }}" # From workflow survey
    networks:
    - name: "{{ vm_static_portgroup }}" # From workflow survey
      connected: true
      start_connected: true
      device_type: vmxnet3
      type: static
      ip: "{{ static_ip }}" # From workflow survey
      netmask: "{{ subnet_mask }}" # From workflow survey
      gateway: "{{ default_gateway }}" # From workflow survey
      #dns_servers: "{{ dns_server_ip }}" # From workflow survey
      #domain: "{{ win_domain_fqdn }}" # From workflow survey
      wait_for_ip_address: true
      wait_for_ip_address_timeout: 600
    state: poweredon

    
  #register: vm_facts_after_build
  #until: vm_facts_after_build.instance.ipv4 is not none
  #retries: 5
  #delay: 2

